<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="utf-8">
    <title>layui</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" th:href="@{/styles/lib/layui-v2.5.5/css/layui.css}" media="all">
    <link rel="stylesheet" th:href="@{/styles/css/public.css}" media="all">
    <style>
        body {
            background-color: #ffffff;
        }
    </style>
</head>
<body>
<form id="menuForm" lay-filter="menuForm" class="layui-form model-form">
    <div class="layui-form-item">
        <label class="layui-form-label">权限名称<span style="color: red;">*</span></label>
        <div class="layui-input-block">
            <input name="title" placeholder="请输入权限名称" type="text" class="layui-input" lay-verify="required"
                   autocomplete="off" required/>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">父级标识<span style="color: red;">*</span></label>
        <div class="layui-input-block">
            <input id="pid" name="pid" type="hidden"/>
            <input id="pcodeName" placeholder="请输入父级编号" type="text" class="layui-input"
                   autocomplete="off" lay-verify="required" required/>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">是否是菜单<span style="color: red;">*</span></label>
        <div class="layui-input-block">
            <input type="radio" name="isMenu" value="0" title="是" checked/>
            <input type="radio" name="isMenu" value="1" title="不是"/>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">请求URL</label>
        <div class="layui-input-block">
            <input id="href" name="href" placeholder="请输入请求地址" type="text" class="layui-input" autocomplete="off"/>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">排序</label>
        <div class="layui-input-block">
            <input name="sort" placeholder="请输入排序" type="text" class="layui-input"/>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">图标</label>
        <div class="layui-input-block">
            <input name="icon" placeholder="请输入图标" type="text" class="layui-input"/>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-input-block">
            <button class="layui-btn" lay-filter="btnSubmit" lay-submit>保存</button>
            <button class="layui-btn layui-btn-primary" type="button" id="rest">取消</button>
        </div>
    </div>
</form>
<script th:src="@{/styles/lib/layui-v2.5.5/layui.js}" charset="utf-8"></script>
<script th:src="@{/styles/lib/jquery-3.4.1/jquery-3.4.1.min.js}" charset="utf-8"></script>
<!--导入自定义的一些公共方法-->
<script th:src="@{/styles/js/my_function.js}"></script>
<script>
    layui.use(['form'], function () {
        var form = layui.form,
            layer = layui.layer;

        // 点击父级菜单
        $('#pcodeName').click(function () {
            layer.open({
                type: 2,
                title: ['父级菜单', 'background-color: #2F4056; color: #ffffff;'],
                area: ['300px', '400px'],
                content: '/menu/commonTree',
                end: function () {
                    $("#pid").val(localStorage.pid);
                    $("#pcodeName").val(localStorage.title);
                    localStorage.removeItem("pid");
                    localStorage.removeItem("title");
                }
            });
        });

        //监听提交
        form.on('submit(btnSubmit)', function (data) {
            //如果是菜单的话，将href置换为空
            data.field.href = data.field.isMenu == 0 ? "" : data.field.href;
            ajax_hasData('/menu/hasParent', 'post', {pid: data.field.pid}, function (rest) {
                if (rest.code == 200) {
                    //添加菜单
                    ajax_hasData('/menu/addMenu', 'post', data.field, function (rest) {
                        if (rest.code == 200) {
                            layer.msg(rest.message);
                        } else {
                            layer.msg(rest.message, {icon: 2, time: 3 * 1000, shift: 6});
                        }
                    });
                } else {
                    layer.msg(rest.message, {icon: 2, time: 3 * 1000, shift: 6});
                }
            });
            return false;
        });

        $('#rest').click(function () {
            var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
            parent.location.reload();//刷新父页面，注意一定要在关闭当前iframe层之前执行刷新
            parent.layer.close(index); //再执行关闭
        })
    });
</script>
</body>
</html>